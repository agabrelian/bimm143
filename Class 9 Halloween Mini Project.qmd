---
title: "Class 09 Halloween Mini project"
author: "Ani A16647613"
format: pdf
---



Here we are going to analyze a candy dataset from the 538 website, which is a CSV file 

# Importing candy data
```{r}
candy_file <- "candy-data.txt"
candy = read.csv(candy_file, row.names=1)
head(candy)

```
> Q1. How many different candy types are in this dataset?

```{r}
dim(candy)
```
85 different candy types

> Q2. How many fruity candy types are in the dataset?

```{r}
sum(candy$fruity)
```

# Exploring the Dataset

> Q3. What is your favorite candy in the dataset and what is its `winpercent` value?

```{r}
candy["Reese's Peanut Butter cup",]$winpercent
```

> Q4. What is the `winpercent` value for KitKat?

```{r}
candy["Kit Kat",]$winpercent
```

> Q5. What is the `winpercent` value for "Tootsie Roll Snack bars?

```{r}
candy["Tootsie Roll Snack Bars",]$winpercent
```

```{r}
library("skimr")
skim(candy)
```


> Q. What is the least liked candy in the dataset- lowest winpercent

```{r}
inds <- order(candy$winpercent)
head( candy[inds, ] )
```

```{r}
skimr::skim(candy)
```

> Q6. Is there any variable/column that looks to be on a different scale to the majority of the other columns in the dataset?

The variable `winpercent` has a different scale compared to the majority of the others.

> Q7. What do you think a zero and one represent for the `candy$chocolate` column>

The zero represents candy that is not considered a part of the chocolate subset, one represents candy that is a part of the chocolate subset.

> Q8. Plot a histogram of winpercent values.

```{r}
library(ggplot2)
ggplot(candy, aes(winpercent)) + geom_histogram(binwidth=4)
hist(candy$winpercent, breaks=12)
```

> Q9. Is the distribution of `winpercent` values symmetrical?

The distribution is not symmetrical 

> Q10. Is the center of the distribution above or below 50%?

The distribution is below 50%
 
> Q11. On average is chocolate candy higher or lower ranked than fruit candy?

```{r}
mean(candy$winpercent[as.logical(candy$chocolate)])
mean(candy$winpercent[as.logical(candy$fruity)])
```
or 

```{r}
choc.inds <- as.logical(candy$chocolate)
choc.win <- candy[choc.inds,]$winpercent
mean(choc.win)
```
```{r}
#candy$fruity == 1
fruit.inds <- as.logical(candy$fruity)
fruit.win <- candy[fruit.inds,]$winpercent
mean(fruit.win)
```

> Q12. Is the difference statistically significant?

```{r}
t.test(choc.win, fruit.win)
```
The difference is statistically significant (p-valuue: 2.87e-08).

## Overall Candy Rankings

> Q13. What are the five least liked candy types in this set?

Nik L Nip, Boston Baked Beans, Chiclets, Super Bubble, Jawbusters

> Q14. What are the top 5 candy types out of this set?

Reese's peanutbutter cups, reese's miniatures, twix, Kit Kat, Snickers

> Q15. Make a first barplot of candy ranking based on `winpercent` values.

```{r}
ggplot(candy) +
  aes(winpercent, rownames(candy)) +
  geom_col()
```

> Q16. Use the reorder() function to get the bars sorted by `winpercent`.

```{r}
ggplot(candy) +
  aes(winpercent, reorder(rownames(candy), winpercent))  + 
   labs(x= "Win Percent values", y=NULL) +
  geom_col() + theme(axis.text.y = element_text(size = 4.8))
```
or

```{r}
ggplot(candy) +
  aes(winpercent, reorder(rownames(candy), winpercent))  + 
   labs(x= "Win Percent values", y=NULL) +
  geom_col()

ggsave("barplot1.png", width=7, height=10)

```
You can insert any image using this markdown syntax:

![Candy Dataset](barplot1.png)

![an example](https://bioboot.github.io/bimm143_W24/assets/img/logo.png)


Add some color to our ggplot. We need to make a custom color vector:

```{r}
#start with all black
my_cols <- rep("black", nrow(candy))
my_cols[as.logical(candy$chocolate)] <- "chocolate"
my_cols[as.logical(candy$bar)] <- "brown"
my_cols[as.logical(candy$fruity)] <- "red"
my_cols
```

```{r}
ggplot(candy) +
  aes(winpercent, reorder(rownames(candy), winpercent))  + 
   labs(x= "Win Percent values", y=NULL) +
  geom_col(fill=my_cols)
```

Based on the plot: 

> Q17. What is the worst ranked chocolate candy?

Charleston Chew

> Q18. What is the best ranked fruit candy?

Skittles

# Takinf a look at pricepercent

```{r}
candy$pricepercent
```

If we want to see what is a good candy to buy in terms of winpercent and pricepercent we can plot these two variables and then see the best candy for the least amount of money

```{r}
ggplot(candy) +
  aes(winpercent, pricepercent, label=rownames(candy)) +
  geom_point(col=my_cols) +
  geom_text()


```

To avoid the overplotting of all the labels we can use an add on package called ggrepel
```{r}
library(ggrepel)

ggplot(candy) +
  aes(winpercent, pricepercent, label=rownames(candy)) +
  geom_point(col=my_cols) +
  geom_text_repel()
```

```{r}
# pink was too hard to see so changed fruity color to red
ggplot(candy) +
  aes(winpercent, pricepercent, label=rownames(candy)) +
  geom_point(col=my_cols) +
  geom_text_repel(max.overlaps = 5, col=my_cols)
```

> Q21. Make a barplot again with geom_col() this time using pricepercent and then improve this step by step, first ordering the x-axis by value and finally making a so called “dot chat” or “lollipop” chart by swapping geom_col() for geom_point() + geom_segment().

# Section 5 Exploring the correlation structure

```{r}
library(corrplot)

cij <- cor(candy)
corrplot(cij)
```

> Q22. Examining this plot what two variables are anti-correlated (i.e. have minus values)?

Chocolate and fruity

> Q23. Similarly, what two variables are most positively correlated?

chocolate and chocolate, caramel and caramel, etc as going down the diagonal middle line
also, chocolate and bar

# PCA

The main function of this is `prcom()`, an we know we need to scale our data with the `scale= TRUE` argument

```{r}
pca <- prcomp(candy, scale= TRUE)
summary(pca)
```

Plot my main PCA score plot with ggplot 

```{r}
# new dataframe with PCA results
my_data <- cbind(candy, pca$x[,1:3])

```

```{r}
ggplot(my_data) + 
        aes(x=PC1, y=PC2,
            label=rownames(candy)) +
        geom_point(col=my_cols) +
    geom_text_repel(col=my_cols) + 
  labs(title= "Halloween Candy PCA ")
```

## Loadings plot 

```{r}
pca$rotation
```

```{r}
loadings <- as.data.frame(pca$rotation)
ggplot(loadings) +
  aes(PC1, reorder(rownames(loadings), PC1)) + 
  geom_col()
```

```{r}
barplot(pca$rotation[,1], las=2, ylab= "PC1 contribution")
```


> Q24. What original variables are picked up strongly by PC1 in the positive direction? Do these make sense to you?

Fruity, hard, and pluribus captured by PC1 and by correlation, therefore they do make sense.

